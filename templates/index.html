<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>AI Governance Security Testbed</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f7f6; }
        .security-log { 
            font-family: 'Courier New', monospace; 
            font-size: 0.85rem; height: 350px; overflow-y: auto; 
            background: #212529; color: #00ff41; padding: 15px; border-radius: 8px;
        }
        .log-entry { border-bottom: 1px solid #333; padding: 8px 0; }
        .status-blocked { color: #ff4b2b; font-weight: bold; }
        .status-safe { color: #00ff41; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container py-5">
        <h2 class="mb-4 text-center">ğŸ›¡ï¸ AI Governance & Security Dashboard</h2>
        <div class="row">
            <div class="col-lg-6">
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-primary text-white">AI Interface</div>
                    <div class="card-body">
                        <label class="form-label fw-bold">User ID</label>
                        <input type="text" id="user" class="form-control mb-3" value="tester_01">
                        <label class="form-label fw-bold">Question</label>
                        <textarea id="question" class="form-control mb-3" rows="4"></textarea>
                        <button id="sendBtn" class="btn btn-primary w-100">Send to AI Engine</button>
                    </div>
                </div>
                <div class="card shadow-sm">
                    <div class="card-header bg-dark text-white">AI Response</div>
                    <div class="card-body bg-white" id="ai-response" style="min-height: 100px;">
                        ë‹µë³€ ëŒ€ê¸° ì¤‘...
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-warning">Real-time Security Monitor</div>
                    <div class="card-body d-flex flex-column">
                        <div id="monitor-logs" class="security-log flex-grow-1">
                            ëŒ€ê¸° ì¤‘...
                        </div>
                        <div class="mt-2 text-end">
                            <span class="badge bg-secondary">Total Scans: <span id="count">0</span></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let scanCount = 0;
        // ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ë°”ì¸ë”© (onclickë³´ë‹¤ ì•ˆì •ì )
        document.getElementById('sendBtn').addEventListener('click', async () => {
            const user = document.getElementById('user').value;
            const q = document.getElementById('question').value;
            const responseDiv = document.getElementById('ai-response');
            const logDiv = document.getElementById('monitor-logs');

            if (!q.trim()) return;

            responseDiv.innerHTML = "Processing...";
            if (scanCount === 0) logDiv.innerHTML = ""; // ì²˜ìŒ ì‹œë„ ì‹œ ì•ˆë‚´ë¬¸êµ¬ ì‚­ì œ

            try {
                // ë°±ì—”ë“œ í˜¸ì¶œ
                const res = await fetch(`/ask?user=${encodeURIComponent(user)}&q=${encodeURIComponent(q)}`);
                const data = await res.json();
                
                scanCount++;
                document.getElementById('count').innerText = scanCount;

                const timestamp = new Date().toLocaleTimeString();
                let logEntry = `<div class="log-entry">`;
                logEntry += `[${timestamp}] <strong>User: ${user}</strong><br>`;

                if (res.status === 403) {
                    // ì°¨ë‹¨ëœ ê²½ìš° (ë°±ì—”ë“œì—ì„œ return jsonify(..., 403) ë³´ëƒ„)
                    logEntry += `<span class="status-blocked">RESULT: BLOCKED</span><br>`;
                    logEntry += `Reason: ${data.reason || "Policy Violation"}`;
                    responseDiv.innerHTML = `<span class="text-danger">${data.answer}</span>`;
                } else if (res.ok) {
                    // ì„±ê³µ
                    logEntry += `<span class="status-safe">RESULT: PASSED</span>`;
                    responseDiv.innerText = data.answer;
                } else {
                    // ê¸°íƒ€ ì—ëŸ¬ (500 ë“±)
                    logEntry += `<span class="text-warning">RESULT: ERROR (${res.status})</span>`;
                    responseDiv.innerText = data.answer || "Unknown Error";
                }
                
                logEntry += `</div>`;
                logDiv.innerHTML = logEntry + logDiv.innerHTML;

            } catch (error) {
                console.error("Fetch error:", error);
                responseDiv.innerText = "ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
            }
        });
    </script>
</body>
</html>